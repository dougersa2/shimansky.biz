(function(e,g){"function"===typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(k,m){return g(e,k,m)}):"object"===typeof exports?module.exports=g(e,require("eventEmitter"),require("eventie")):e.imagesLoaded=g(e,e.EventEmitter,e.eventie)})(this,function(e,g,k){function m(a,b){for(var c in b)a[c]=b[c];return a}function r(a){var b=[];if("[object Array]"===s.call(a))b=a;else if("number"===typeof a.length)for(var c=0,h=a.length;c<h;c++)b.push(a[c]);else b.push(a);
return b}function d(a,b,c){if(!(this instanceof d))return new d(a,b);"string"===typeof a&&(a=document.querySelectorAll(a));this.elements=r(a);this.options=m({},this.options);"function"===typeof b?c=b:m(this.options,b);if(c)this.on("always",c);this.getImages();l&&(this.jqDeferred=new l.Deferred);var h=this;setTimeout(function(){h.check()})}function n(a){this.img=a}function f(a){this.src=a;p[a]=this}var l=e.jQuery,q=e.console,t="undefined"!==typeof q,s=Object.prototype.toString;d.prototype=new g;d.prototype.options=
{};d.prototype.getImages=function(){this.images=[];for(var a=0,b=this.elements.length;a<b;a++){var c=this.elements[a];"IMG"===c.nodeName&&this.addImage(c);for(var c=c.querySelectorAll("img"),h=0,d=c.length;h<d;h++)this.addImage(c[h])}};d.prototype.addImage=function(a){a=new n(a);this.images.push(a)};d.prototype.check=function(){function a(a,e){b.options.debug&&t&&q.log("confirm",a,e);b.progress(a);c++;c===d&&b.complete();return!0}var b=this,c=0,d=this.images.length;this.hasAnyBroken=!1;if(d)for(var e=
0;e<d;e++){var f=this.images[e];f.on("confirm",a);f.check()}else this.complete()};d.prototype.progress=function(a){this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded;var b=this;setTimeout(function(){b.emit("progress",b,a);b.jqDeferred&&b.jqDeferred.notify&&b.jqDeferred.notify(b,a)})};d.prototype.complete=function(){var a=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var b=this;setTimeout(function(){b.emit(a,b);b.emit("always",b);if(b.jqDeferred)b.jqDeferred[b.hasAnyBroken?"reject":"resolve"](b)})};
l&&(l.fn.imagesLoaded=function(a,b){return(new d(this,a,b)).jqDeferred.promise(l(this))});n.prototype=new g;n.prototype.check=function(){var a=p[this.img.src]||new f(this.img.src);if(a.isConfirmed)this.confirm(a.isLoaded,"cached was confirmed");else if(this.img.complete&&void 0!==this.img.naturalWidth)this.confirm(0!==this.img.naturalWidth,"naturalWidth");else{var b=this;a.on("confirm",function(a,d){b.confirm(a.isLoaded,d);return!0});a.check()}};n.prototype.confirm=function(a,b){this.isLoaded=a;this.emit("confirm",
this,b)};var p={};f.prototype=new g;f.prototype.check=function(){if(!this.isChecked){var a=new Image;k.bind(a,"load",this);k.bind(a,"error",this);a.src=this.src;this.isChecked=!0}};f.prototype.handleEvent=function(a){var b="on"+a.type;if(this[b])this[b](a)};f.prototype.onload=function(a){this.confirm(!0,"onload");this.unbindProxyEvents(a)};f.prototype.onerror=function(a){this.confirm(!1,"onerror");this.unbindProxyEvents(a)};f.prototype.confirm=function(a,b){this.isConfirmed=!0;this.isLoaded=a;this.emit("confirm",
this,b)};f.prototype.unbindProxyEvents=function(a){k.unbind(a.target,"load",this);k.unbind(a.target,"error",this)};return d});
//# sourceMappingURL=imagesloaded.min.js.map
